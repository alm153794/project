-- Full Database Schema for gym_fitness_house_db

CREATE DATABASE IF NOT EXISTS `gym_fitness_house_db`;
USE `gym_fitness_house_db`;

--
-- Table structure for table `admins`
--
CREATE TABLE `admins` (
  `admin_id` INT AUTO_INCREMENT PRIMARY KEY,
  `username` VARCHAR(50) NOT NULL UNIQUE,
  `password_hash` VARCHAR(255) NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

--
-- Table structure for table `users`
--
CREATE TABLE `users` (
  `user_id` INT AUTO_INCREMENT PRIMARY KEY,
  `username` VARCHAR(100) NOT NULL,
  `email` VARCHAR(100) NOT NULL UNIQUE,
  `password_hash` VARCHAR(255) NOT NULL,
  `plan_key` VARCHAR(50) DEFAULT NULL,
  `payment_status` ENUM('pending', 'completed', 'failed', 'none', 'pending_approval') DEFAULT 'none',
  `registration_date` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `last_login` TIMESTAMP NULL DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

--
-- Table structure for table `plans`
--
CREATE TABLE `plans` (
  `plan_key` VARCHAR(50) PRIMARY KEY,
  `plan_name` VARCHAR(100) NOT NULL,
  `price` DECIMAL(10, 2) NOT NULL,
  `description` TEXT DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

--
-- Dumping data for table `plans`
--
INSERT INTO `plans` (`plan_key`, `plan_name`, `price`, `description`) VALUES
('basic', 'Basic Access', 29.00, 'Access to all gym equipment during standard hours.'),
('pro', 'Pro Fitness', 59.00, 'All Basic features plus unlimited group classes and more.'),
('elite', 'Elite Performance', 99.00, 'All Pro features plus personal training sessions and premium perks.');

--
-- Table structure for table `payments`
--
CREATE TABLE `payments` (
  `payment_id` INT AUTO_INCREMENT PRIMARY KEY,
  `user_id` INT NOT NULL,
  `plan_key` VARCHAR(50) NOT NULL,
  `amount_paid` DECIMAL(10, 2) NOT NULL,
  `payment_date` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `transaction_id` VARCHAR(100) DEFAULT NULL,
  `card_name` VARCHAR(100) DEFAULT NULL,
  `status` ENUM('pending_approval', 'approved', 'failed') DEFAULT 'pending_approval',
  FOREIGN KEY (`user_id`) REFERENCES `users`(`user_id`) ON DELETE CASCADE,
  FOREIGN KEY (`plan_key`) REFERENCES `plans`(`plan_key`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

--
-- Table structure for table `messages`
--
CREATE TABLE `messages` (
  `message_id` INT AUTO_INCREMENT PRIMARY KEY,
  `name` VARCHAR(100) NOT NULL,
  `email` VARCHAR(100) NOT NULL,
  `subject` VARCHAR(255) NOT NULL,
  `message` TEXT NOT NULL,
  `received_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `is_read` BOOLEAN DEFAULT FALSE,
  `replied_at` TIMESTAMP NULL DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

--
-- Constraints for table `users`
--
ALTER TABLE `users` ADD CONSTRAINT `fk_users_plans` FOREIGN KEY (`plan_key`) REFERENCES `plans`(`plan_key`) ON DELETE SET NULL;
